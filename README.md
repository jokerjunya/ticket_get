# Ticket Get

チケット自動購入のための情報入力アプリです。ローソンチケットのチケット販売ページから自動的にチケットを購入するためのMac用アプリケーションです。

## 機能

- チケット情報の事前登録
- ログイン情報の保存
- 購入者情報の入力
- 支払い・受取方法の選択
- 設定した時間に自動的にチケット購入プロセスを開始

## インストール方法

```bash
# リポジトリをクローン
git clone https://github.com/yourusername/ticket_get.git

# ディレクトリに移動
cd ticket_get

# 依存関係をインストール
npm install

# アプリを起動
npm start
```

## 使用方法

### 1. 購入情報の入力と保存

1. チケット販売ページのURLを入力
2. 販売開始時刻を設定
3. 枚数と席種を選択
4. ログイン情報を入力
5. 購入者情報を入力
6. 支払い・受取方法を選択
7. 保存ボタンをクリック
8. 「保存データをエクスポート」ボタンでJSONファイルをダウンロード
9. ダウンロードしたJSONファイルを `scripts` フォルダに `localStorage-export.json` として配置

### 2. 自動購入の方法

#### 2.1 即時実行

```bash
# スクリプトを直接実行（ブラウザを表示）
npm run auto-purchase

# ヘッドレスモードで実行（ブラウザを非表示）
npm run auto-purchase -- --headless

# カスタムJSONファイルを指定して実行
npm run auto-purchase -- path/to/custom-info.json
```

#### 2.2 スケジューラーを使った自動実行

```bash
# デフォルトの購入情報ファイル(purchase-info.json)を使用
npm run schedule

# 特定のJSONファイルを指定して実行
npm run schedule -- path/to/custom-info.json

# 複数のJSONファイルを同時に処理
npm run schedule-all
```

スケジューラーは、JSONファイル内の `saleTime` または `saleStartTime` に指定された時刻になると自動的に購入処理を開始します。

#### 2.3 フォームデータの変換

フォームデータからPuppeteer用のJSONファイルを作成する場合：

```bash
# フォームデータをPuppeteer用JSONに変換
node scripts/form-to-json.js

# 出力先を指定
node scripts/form-to-json.js output.json
```

## 自動購入機能の詳細

自動購入スクリプトは以下の処理を行います：

1. 購入情報をJSONから読み込み
2. ブラウザを起動
3. ローソンチケットにログイン
4. 指定されたチケット販売ページにアクセス
5. 席種と枚数を選択
6. 購入者情報を入力
7. 支払い方法と受取方法を選択
8. 申し込みボタンをクリック

### CAPTCHA対応

CAPTCHAが表示された場合、スクリプトは一時停止し、手動操作を要求します。
CAPTCHA入力後にキーを押すと、処理が再開されます。

### 実行オプション

- `--headless`: ブラウザを表示せずにバックグラウンドで実行
- `--schedule`: 設定された販売開始時刻に合わせて自動実行
- 第1引数: カスタムJSONファイルのパス

## スケジューラーの詳細

スケジューラーは以下の機能を提供します：

- 指定された時刻まで待機し、時刻になると自動的にスクリプトを実行
- 複数の購入情報ファイルを同時に監視し、それぞれの指定時刻に実行
- ログを `scheduler-log.txt` に出力（実行時刻、処理状況など）
- 子プロセスとして購入スクリプトを実行（スケジューラーが終了しても購入処理は継続）

## スケジューラーの使用方法

### 基本的な使い方

スケジューラーは指定された時間に自動的に購入スクリプトを実行する機能です。

```bash
# デフォルトの購入情報を使ってスケジュール実行
npm run schedule

# 特定の購入情報ファイルを指定
npm run schedule -- path/to/custom-info.json

# すべての購入情報ファイルを処理
npm run schedule-all
```

### オプションの指定

スケジューラーは購入スクリプトへオプションを渡すことができます：

```bash
# ヘッドレスモードでスケジュール実行（ブラウザが表示されません）
npm run schedule -- --headless

# 特定のファイルをヘッドレスモードで実行
npm run schedule -- path/to/custom-info.json --headless

# すべてのファイルをヘッドレスモードで実行
npm run schedule-all -- --headless
```

### スケジューラーの動作

スケジューラーは以下のように動作します：

1. 購入情報ファイル（`purchase-info.json`）から販売開始時刻を読み取ります
2. 販売開始時刻まで待機します（コンソールに残り時間が表示されます）
3. 指定時刻になると自動的に購入スクリプトを実行します
4. 実行の詳細や結果は `scheduler-log.txt` に記録されます

### 複数の購入情報ファイルの処理

`--all` オプションを使用すると、`purchase-info*.json` にマッチするすべてのファイルを自動的に処理します。これにより、複数の異なるチケット購入をスケジュールできます。

### 購入情報ファイルの設定

購入情報ファイルには以下の内容が必要です：

```json
{
  "url": "https://example.com/ticket-page",
  "saleTime": "2023-12-01T10:00:00+09:00"
}
```

`saleTime` フィールドはISO8601形式の日本時間で指定します。

## 技術スタック

- React (フロントエンド)
- Tailwind CSS (スタイリング)
- Node.js + Puppeteer (自動購入処理)
- LocalStorage (データ保存)

## 開発者向け情報

### 開発環境のセットアップ

```bash
# 開発サーバー起動
npm start

# ビルド
npm run build
```

### 注意事項

- このツールの使用は自己責任で行ってください
- 対象サイトの規約に違反する可能性がある場合は使用を控えてください
- 大量アクセスによるサーバー負荷を避けるため、適切な間隔でリトライを行ってください

## ライセンス

MIT 